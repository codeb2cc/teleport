/*! 2012-11-08 07:19
 *  Copyright (c) 2012 codeb2cc.com
 */
(function(){"use strict";ko.bindingHandlers.fade={update:function(e,t){var n=ko.utils.unwrapObservable(t()),r=e.style.display!="none";n&&!r?$(e).fadeIn():!n&&r&&$(e).fadeOut()}}})(),function(){"use strict";$(function(){function e(e){this.id=e.id,this.label=ko.observable(e.label),this.counter=ko.observable(e.counter),this.token=ko.observable(e.token),$.each(e.records,function(e,t){t.date=new Date(t.date)}),this.records=ko.observableArray(e.records),this.hidden=ko.observable(!0),this.ip=ko.computed(function(){return this.records().length?this.records()[0].ip:""},this),this.message=ko.computed(function(){return this.records().length?this.records()[0].message:""},this),this.update=function(e){this.id=e.id,this.label(e.label),this.counter(e.counter),this.token(e.token),this.records.removeAll();for(var t=0;t<e.records.length;t++)e.records[t].date=new Date(e.records[t].date),this.records.push(e.records[t])},this.edit=function(e,t){var n=$(t.target).next(".editor");n.show(),n.find("input").focus()},this.reset=function(e,t){var n=$(t.target).parents(".editor");n.find("input").val(e.label()),n.hide()}}function t(){var t=this;this.gates=ko.observableArray([]),this.activeGate=ko.observable(),this.add=function(){if(event.type==="keypress"&&event.keyCode!==13)return!0;var n=$("#control-add input"),r=n.val();if(this.gates().length>=5||r==="")return!1;$.ajax({url:"/post/",type:"POST",data:{label:r},dataType:"json",success:function(r,i,s){t.gates.unshift(new e(r.data)),n.val("")},error:function(e,t,n){}})},this.search=function(e,t){var n=$("#control-search input"),r=n.val();return $.each(this.gates(),function(e,t){t.hidden(t.label().search(r)!==-1)}),!0},this.edit=function(e,t){if(t.type==="keypress"&&t.keyCode!==13)return!0;var n=$(t.target).parents(".editor");$.ajax({url:"/put/",type:"PUT",data:{id:e.id,label:n.find("input").val()},dataType:"json",success:function(t,r,i){e.update(t.data),n.hide()},error:function(e,t,n){}})},this.history=function(e){t.activeGate(null).activeGate(e),$("#modal-history").modal("show")},this.reset=function(e){$.ajax({url:"/reset/",type:"POST",data:{id:e.id},dataType:"json",success:function(t,n,r){e.update(t.data)},error:function(e,t,n){}})},this.remove=function(e){$.ajax({url:"/delete/",type:"DELETE",data:{id:e.id},dataType:"json",success:function(n,r,i){t.gates.remove(e)},error:function(e,t,n){}})},$.getJSON("/get/",function(n){var r=$.map(n.data,function(t){return new e(t)});t.gates(r)})}var n=new t;ko.applyBindings(n)})}();